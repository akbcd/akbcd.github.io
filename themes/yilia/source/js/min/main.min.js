!function(){var backTop=function(domE,ctn,distance){if(!domE)return;var timer=null;var _onscroll=window.onscroll,_onclick=domE.onclick;ctn.onscroll=throttle(function(){typeof _onscroll==='function'&&_onscroll.apply(this,arguments);toggleDomE()},100);window.onscroll=ctn.onscroll;domE.onclick=function(){typeof _onclick==='function'&&_onclick.apply(this,arguments);timer=setInterval(function(){var ct=ctn.scrollTop||document.documentElement.scrollTop||document.body.scrollTop;var diff=Math.max(10,ct/6);ct-=diff;if(ct>0){ctn.scrollTop=ctn.scrollTop-diff;window.scrollTo(0,ct)}else{ctn.scrollTop=0;window.scrollTo(0,0);clearInterval(timer)}},10)};function toggleDomE(){domE.style.display=(ctn.scrollTop||document.documentElement.scrollTop||document.body.scrollTop)>distance?'block':'none'}function throttle(func,wait){var timer=null;return function(){var self=this,args=arguments;if(timer)clearTimeout(timer);timer=setTimeout(function(){return typeof func==='function'&&func.apply(self,args)},wait)}}};backTop(document.getElementById('js-jump-container'),document.getElementById('container'),500);function generate(url,opts){var url=url.replace(/<%-sUrl%>/g,encodeURIComponent(opts.sUrl)).replace(/<%-sTitle%>/g,opts.sTitle).replace(/<%-sDesc%>/g,opts.sDesc).replace(/<%-sPic%>/g,encodeURIComponent(opts.sPic));window.open(url)}function showWX(){let $wx=document.querySelector('.js-wx-box');let $mask=document.querySelector('.mask');$wx.classList.add('in');$wx.classList.add('ready');$mask.classList.add('in')}function hideWX(){let $wx=document.querySelector('.js-wx-box');let $mask=document.querySelector('.mask');$wx.classList.remove('in');$wx.classList.remove('ready');$mask.classList.remove('in')}function handleClick(type,opts){if(type==='weibo'){generate('http://service.weibo.com/share/share.php?url=<%-sUrl%>&title=<%-sTitle%>&pic=<%-sPic%>',opts)}else if(type==='qq'){generate('http://connect.qq.com/widget/shareqq/index.html?url=<%-sUrl%>&title=<%-sTitle%>&source=<%-sDesc%>',opts)}else if(type==='douban'){generate('https://www.douban.com/share/service?image=<%-sPic%>&href=<%-sUrl%>&name=<%-sTitle%>&text=<%-sDesc%>',opts)}else if(type==='qzone'){generate('http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=<%-sUrl%>&title=<%-sTitle%>&pics=<%-sPic%>&summary=<%-sDesc%>',opts)}else if(type==='facebook'){generate('https://www.facebook.com/sharer/sharer.php?u=<%-sUrl%>',opts)}else if(type==='twitter'){generate('https://twitter.com/intent/tweet?text=<%-sTitle%>&url=<%-sUrl%>&via=<%-config.url%>',opts)}else if(type==='google'){generate('https://plus.google.com/share?url=<%-sUrl%>',opts)}else if(type==='weixin'){showWX()}}let share=function(){let $sns=document.querySelectorAll('.share-sns');if(!$sns||$sns.length===0)return;let sUrl=window.location.href;let sTitle=document.querySelector('title').innerHTML;let $img=document.querySelectorAll('.article-entry img');let sPic=$img.length?document.querySelector('.article-entry img').getAttribute('src'):'';if((sPic!=='')&&!/^(http:|https:)?\/\//.test(sPic)){sPic=window.location.origin+sPic}$sns.forEach(($em)=>{$em.onclick=(e)=>{let type=$em.getAttribute('data-type');handleClick(type,{sUrl:sUrl,sPic:sPic,sTitle:sTitle,sDesc:sTitle})}});document.querySelector('.mask').onclick=hideWX;document.querySelector('.js-modal-close').onclick=hideWX};share();function fix(){if(yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-title,.article-more-a,.archive-article-date,.archive-article-title").forEach(i=>{i.setAttribute("target","_blank")});if(yiliaConfig.isPost)document.querySelectorAll(".article-title,.archive-article-date").forEach(i=>{i.removeAttribute("target")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){let $a=document.querySelectorAll(('.toc-number'));$a.forEach(($em)=>{$em.style.display='none'})}var $aboutme=document.querySelector('#js-aboutme');if($aboutme&&$aboutme.length!==0){$aboutme.innerHTML=$aboutme.innerText}}fix();function Viwer(){let pswpElement=document.querySelectorAll('.pswp')[0];let $imgArr=document.querySelectorAll(('.article-entry img:not(.reward-img)'));$imgArr.forEach(($em,i)=>{$em.onclick=()=>{if(document.querySelector('.left-col.show'))return;let items=[];$imgArr.forEach(($em2,i2)=>{let img=$em2.getAttribute('data-idx',i2);let src=$em2.getAttribute('data-target')||$em2.getAttribute('src');let title=$em2.getAttribute('alt');const image=new Image();image.src=src;items.push({src:src,w:image.width||$em2.width,h:image.height||$em2.height,title:title})});var gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,{index:parseInt(i)});gallery.init()}})}window.addEventListener("load",Viwer())}();!function(){const $container=document.getElementById("container");if(yiliaConfig.isPost){const isjQuery=typeof(jQuery)!='undefined';const $toc_link=document.getElementsByClassName("toc-link");function getElementTop(element){let actualTop=element.offsetTop;let current=element.offsetParent;while(current!==null){actualTop+=current.offsetTop;current=current.offsetParent}return actualTop};const isanchor=yiliaConfig.anchor;const updateAnchor=function(anchor){if(window.history.replaceState&&anchor!==window.location.hash){window.history.replaceState(null,null,anchor)}};function toToc(name){const $name=document.getElementById(name.substring(1));const scrollPositionTop=getElementTop($name);if(isjQuery){$('#container').animate({scrollTop:document.body.clientWidth<=800?scrollPositionTop-50:scrollPositionTop},1000);$('body,html').animate({scrollTop:scrollPositionTop-50},1000)}else{if(isanchor)updateAnchor(name);$container.scrollTop=scrollPositionTop;document.documentElement.scrollTop=scrollPositionTop-50;document.body.scrollTop=scrollPositionTop-50}};for(let i in $toc_link){$toc_link[i].onclick=function(e){e.preventDefault();toToc(decodeURI(this.getAttribute('href')))}};if(isjQuery){function tocChild(key,value){for(let i=0;i<$toc_child.length;i++){$toc_child[i].style.cssText=key+":"+value}};const $article_content=document.getElementById('article-content');const $toc_article=document.getElementsByClassName("toc-article")[0];const $toc_child=document.getElementsByClassName("toc-child");tocChild("display","none");const expandToc=function($item){if($item.is(':visible')){return}$item.fadeIn(400)};const autoScrollToc=function(){if(document.querySelector('.toc-link.active')){const activePosition=$('.toc-link.active').position().top;const articleScrolltop=$toc_article.scrollTop;if(activePosition>$toc_article.clientHeight-50){$toc_article.scrollTop=articleScrolltop+150}if(activePosition<50){$toc_article.scrollTop=articleScrolltop-150;if(activePosition<0)$toc_article.scrollTop=0}}};$container.addEventListener('scroll',(e)=>{const currentTop=$container.scrollTop;findHeadPosition(document.body.clientWidth<=800?currentTop+50:currentTop);autoScrollToc()});window.addEventListener('scroll',(e)=>{const currentTop=document.body.scrollTop||document.documentElement.scrollTop;findHeadPosition(currentTop+50);autoScrollToc()});const findHeadPosition=function(top){if($toc_link.length===0){return false};const list=$article_content.querySelectorAll('h1,h2,h3,h4,h5,h6');let currentId='';list.forEach(function(ele){if(top>getElementTop(ele)-10){currentId='#'+ele.getAttribute('id')}});const hexoVersion=(null!=document.querySelector('meta[name="generator"]'))?document.querySelector('meta[name="generator"]').getAttribute("content").substring(5,6):null;const currentActive=$toc_article.querySelectorAll('.active');if(currentId===''){currentActive.forEach(i=>{i.classList.remove('active')});tocChild("display","none")};if(currentId&&decodeURI(currentActive[0]!=null?currentActive[0].getAttribute('href'):null)!==currentId){if(isanchor)updateAnchor(currentId);$toc_article.querySelectorAll('.active').forEach(i=>{i.classList.remove('active')});const _this=(null!=hexoVersion&&hexoVersion>=5)?document.querySelectorAll('.toc-link[href="'+encodeURI(currentId)+'"]')[0]:document.querySelectorAll('.toc-link[href="'+currentId+'"]')[0];_this.classList.add('active');const parents=$(_this).parents('.toc-child');const topLink=(parents.length>0)?parents.last():$(_this);expandToc(topLink.closest('.toc-item').find('.toc-child'));topLink.closest('.toc-item').siblings('.toc-item').find('.toc-child').hide()}}}};if(yiliaConfig.isPost&&yiliaConfig.scrollPos){window.onbeforeunload=function(){const scrollPos=$container.scrollTop||document.documentElement.scrollTop||document.body.scrollTop;document.cookie="scrollTop="+scrollPos};window.onpagehide=function(){const scrollPos=$container.scrollTop||document.documentElement.scrollTop||document.body.scrollTop;document.cookie="scrollTop="+scrollPos};window.addEventListener("load",function(){if(document.cookie.match(/scrollTop=([^;]+)(;|$)/)!=null){const arr=document.cookie.match(/scrollTop=([^;]+)(;|$)/);$container.scrollTop=arr[1];document.documentElement.scrollTop=parseInt(arr[1]);document.body.scrollTop=parseInt(arr[1])}})}}();