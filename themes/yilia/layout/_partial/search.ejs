<% if (theme.local_search && theme.local_search.enable){ %>
<div id="js-searchModal" style="display: none; opacity: 1; top: 10%;">
    <div style="padding: 24px;">
        <div class="search-header">
            <span><i class="icon-search icon"></i>&nbsp;&nbsp;搜索</span>
            <input class="search-ipt" q-model="search" type="text" placeholder="请输入搜索的关键字" id="js-searchInput">
        </div>
        <div id="js-searchResult"></div>
    </div>
</div>
<!--搜索背景层-->
<div id="js-modal-overlay" style="display: none;"></div>
<script type="text/javascript">
    window.onload=function(){
        var jsm = document.getElementById('js-searchModal');
        var jmo = document.getElementById('js-modal-overlay');
        //给搜索图标添加点击事件
        var open = document.getElementById('js-icon-search');
        open.onclick = function(){
            //弹出搜索    
            jsm.style.display = 'block';
            jmo.style.display = 'block';
            document.body.style.position = 'fixed';
            jmo.style.width = document.body.scrollWidth;
            $("#" + 'js-modal-overlay').height($(document).height());
            //背景层样式
            $("#js-modal-overlay").css({
                "position": "fixed",
                "z-index": "1002",
                "top": "-25%",
                "left": "0",
                "bottom": "0",
                "right": "0",
                "height": "125%",
                "width": "100%",
                "background": "rgba(0,0,0,0.6)",
                "will-change": "opacity",
            });
            //搜索弹窗
            $("#js-searchModal").css({
                "min-height": "500px",
                "width": "80%",
                "z-index": "1003",
                "position": "fixed",
                "left": "0",
                "right": "0",
                "background": "linear-gradient(200deg,#a0cfe4,#e8c37e)",
                "max-height": "70%",
                "width": "80%",
                "margin": "auto",
                "overflow-x": "hidden",
                "overflow-y": "auto",
                "border-radius": "2px",
                "will-change": "top, opacity"
            });
            //修改搜索框样式
            $("#js-searchInput").css({"width":"100%"});
            $(".search-header").css({"color": "#fff"});
        }
        //关闭搜索
        var close = document.getElementById('js-modal-overlay');
        close.onclick = function(){
            jsm.style.display = 'none';
            jmo.style.display = 'none';
            $('body').removeAttr('style');
        }
    }
</script>
<!-- 引入jquery -->
<script src="<%=config.root%>jquery-3.4.1.js"></script>
<!-- 实现本地搜索函数 -->
<script type="text/javascript">
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title != '' && data_content != '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i == 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start == 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                    //搜索结果样式修改
                    $(".search-result-list li").css({
                        "border-bottom":"1px dotted #dcdcdc",
                        "padding-top": "5px"
                    });
                    //搜索结果标题样式
                    $(".search-result-list a").css({
                        "color": "#fffff8",
                        "font-size":"18px",
                        "font-weight": "300",
                        "line-height": "35px"
                    });
                    $(".search-result-list .search-result").css({
                        "font-size": "16px",
                        "color": "#fffdd8"
                    });
                    $(".search-result-list .search-keyword").css({
                        "color":"#e96900",
                        "font-style":"normal"
                    })
                });
            }
        });
    }
    //调用搜索函数
    $(function () {
        searchFunc("/" + "search.xml", 'js-searchInput', 'js-searchResult');
    });
</script>
<% } %>